@page "/empresas/edit/{id:int}"
@inject IHttpClientFactory ClientFactory
@using System.Net.Http.Json
@using Microsoft.AspNetCore.Components.Forms

<h3>Editar Empresa</h3>

@if (Empresa == null)
{
    <p>Carregando...</p>
}
else
{
    <EditForm Model="@Empresa" OnValidSubmit="Salvar">
        <DataAnnotationsValidator />
        <ValidationSummary />

        <div class="mb-3">
            <label class="form-label">Nome</label>
            <InputText class="form-control" @bind-Value="Empresa.Nome" />
        </div>

        <div class="mb-3">
            <label class="form-label">Endereço</label>
            <InputText class="form-control" @bind-Value="Empresa.Endereco" />
        </div>

        <div class="mb-3">
            <label class="form-label">Atividade Principal</label>
            <InputText class="form-control" @bind-Value="Empresa.AtividadePrincipal" />
        </div>

        <button class="btn btn-primary" type="submit">Salvar</button>
    </EditForm>
}

@code {
    [Parameter] public int id { get; set; }

    private HttpClient Http => ClientFactory.CreateClient("ApiClient");
    private EmpresaDto? Empresa;

    protected override async Task OnInitializedAsync()
    {
        Empresa = await Http.GetFromJsonAsync<EmpresaDto>($"api/empresas/{id}");
    }

    private async Task Salvar()
    {
        await Http.PutAsJsonAsync($"api/empresas/{id}", Empresa);
    }

    public class EmpresaDto
    {
        public string? Nome { get; set; }
        public string? Endereco { get; set; }
        public string? AtividadePrincipal { get; set; }
    }
}
